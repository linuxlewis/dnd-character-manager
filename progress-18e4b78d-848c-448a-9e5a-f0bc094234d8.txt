# Progress Log
Run: 18e4b78d-848c-448a-9e5a-f0bc094234d8
Task: Add slug-based sharing for characters
Started: 2026-02-23 18:37 CST

## ⚠️ WORKTREE
All work MUST happen in: /tmp/feature-slug-based-sharing
Do NOT work in /Users/sambolgert/Documents/workspace/dnd-character-manager (that's the main repo)

## Codebase Patterns
- Test DB is created manually in `src/test-setup.ts` with raw SQL (not migrations). When adding columns to schema, must also update the CREATE TABLE in test-setup.ts.
- Schema is in `src/providers/db/schema.ts`, uses Drizzle ORM with better-sqlite3
- Migrations generated via `npx drizzle-kit generate`, output to `drizzle/` folder
- Tests use vitest, run with `pnpm test`
- Build includes typecheck: `pnpm run build` runs `tsc --noEmit && vite build`
- DB singleton via `getDb()`, tests override with `_setDb()` in test-setup.ts
- Repo maps DB rows to domain types in `toDomain()` function
- Path aliases: `@providers` → `src/providers`, `@domains` → `src/domains`

---

## 2026-02-23 18:38 - US-001: Add slug column to characters schema and generate migration
- Added `slug: text('slug').unique()` to characters table in schema.ts
- Generated migration `drizzle/0001_useful_white_queen.sql` (ALTER TABLE + CREATE UNIQUE INDEX)
- Updated test-setup.ts to include slug column in the in-memory test DB
- Added test for slug column existence, nullability, and uniqueness in schema.test.ts
- Updated expected columns list in existing schema test
- Files changed: src/providers/db/schema.ts, src/providers/db/schema.test.ts, src/test-setup.ts, drizzle/0001_useful_white_queen.sql, drizzle/meta/*
- **Learnings:** Test DB setup is manual SQL in test-setup.ts — must keep in sync with schema changes
---
